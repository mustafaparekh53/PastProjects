{"version":3,"sources":["../../src/webparts/approvalForm/components/appresults/Apprhistory.tsx"],"names":[],"mappings":"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","file":"webparts/approvalForm/components/appresults/Apprhistory.js","sourcesContent":["import React = require(\"react\");\r\nimport { IAppresultporp } from \"./IAppresultprop\";\r\nimport { IAppresultstate, IAppresult } from \"./IAppresult\";\r\nimport { sp } from \"@pnp/sp\";\r\nimport \"@pnp/polyfill-ie11\";\r\nimport styles from \"./Apprhistory.module.scss\";\r\nimport { WebConfig } from \"../../../ComComponents/webconfig\";\r\nimport * as moment from \"moment\";\r\nimport \"moment/locale/zh-cn\";\r\nexport class Apprhistory extends React.Component<\r\n  IAppresultporp,\r\n  IAppresultstate\r\n> {\r\n  constructor(props: any) {\r\n    super(props);\r\n    this.state = { historyItem: [] };\r\n  }\r\n  public render(): React.ReactElement<IAppresultporp> {\r\n    if (this.state.historyItem.length > 0) {\r\n      return (\r\n        <table className={\"table \" + styles.tbhistory}>\r\n          <colgroup>\r\n            <col style={{ width: \"20%\" }} />\r\n            <col style={{ width: \"15%\" }} />\r\n            <col style={{ width: \"25%\" }} />\r\n            <col style={{ width: \"15%\" }} />\r\n            <col style={{ width: \"25%\" }} />\r\n          </colgroup>\r\n          <thead>\r\n            <tr>\r\n              <th className=\"title\" colSpan={5}>\r\n                历史审批情况{\" \"}\r\n              </th>\r\n            </tr>\r\n            <tr>\r\n              <td>审批步骤</td>\r\n              <td>审批结果</td>\r\n              <td>审批意见</td>\r\n              <td>审批日期</td>\r\n              <td>审批人</td>\r\n            </tr>\r\n          </thead>\r\n          {this.state.historyItem.map(hitem => {\r\n            return (\r\n              <tr>\r\n                <td>{hitem.position + \"审批\"}</td>\r\n                <td>\r\n                  {hitem.result\r\n                    ? hitem.position.indexOf(\"审价\") >= 0\r\n                      ? \"价格已审\"\r\n                      : \"合同已审\"\r\n                    : \"驳回\"}\r\n                </td>\r\n                <td\r\n                  className=\"descCont\"\r\n                  dangerouslySetInnerHTML={{\r\n                    __html:\r\n                      hitem.description +\r\n                      (hitem.AttachmentFiles\r\n                        ? \"<div>\" +\r\n                          hitem.AttachmentFiles.map(item => {\r\n                            return `<a href=${\r\n                              item.ServerRelativeUrl\r\n                            } target=\"_blank\">\r\n                                ${item.FileName}\r\n                              </a>`;\r\n                          }).join(\",\") +\r\n                          \"</div>\"\r\n                        : \"\")\r\n                  }}\r\n                />\r\n                <td>{hitem.Created}</td>\r\n                <td className=\"tdUserName\">{hitem.Author}</td>\r\n              </tr>\r\n            );\r\n          })}\r\n        </table>\r\n      );\r\n    }\r\n    return (\r\n      <div>\r\n        <label>暂无审批记录</label>\r\n      </div>\r\n    );\r\n  }\r\n  public componentDidMount(): void {\r\n    //  console.log(\"apprhistory log。。。。\");\r\n    const itemid: number = this.props.contractitemid;\r\n    sp.web.lists\r\n      .getByTitle(WebConfig.AddrListName)\r\n      .items.filter(`itemidId eq ${itemid} and submited eq 1`)\r\n      .orderBy(\"Id\", true)\r\n      .select(\"*\", \"Author/Title\", \"AttachmentFiles\")\r\n      .expand(\"Author\", \"AttachmentFiles\")\r\n      .get()\r\n      .then(items => {\r\n        // console.log(items);\r\n        let datas: IAppresult[] = [];\r\n        items.map((item: any, index: number) => {\r\n          datas.push({\r\n            description: item.description,\r\n            result: item.result,\r\n            position: item.Title,\r\n            Created: moment(item.Created, moment.ISO_8601).format(\r\n              \"YYYY/MM/DD HH:mm:ss\"\r\n            ),\r\n            AttachmentFiles: item.AttachmentFiles.map(fileinfo => {\r\n              return {\r\n                ServerRelativeUrl: fileinfo.ServerRelativeUrl,\r\n                FileName: fileinfo.FileName\r\n              };\r\n            }),\r\n            Author: item.Author.Title\r\n          });\r\n        });\r\n        this.setState({ historyItem: datas });\r\n      });\r\n  }\r\n}\r\n"],"sourceRoot":"..\\..\\..\\..\\..\\src"}