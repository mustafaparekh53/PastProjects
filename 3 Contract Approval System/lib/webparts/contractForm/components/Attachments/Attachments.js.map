{"version":3,"sources":["../../src/webparts/contractForm/components/Attachments/Attachments.tsx"],"names":[],"mappings":"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","file":"webparts/contractForm/components/Attachments/Attachments.js","sourcesContent":["import { IAttachmentprop } from \"./IAttachmentprop\";\r\nimport { IAttachmentState } from \"./IAttachmentState\";\r\nimport React = require(\"react\");\r\nimport { sp } from \"@pnp/sp\";\r\nimport \"@pnp/polyfill-ie11\";\r\nimport { WebConfig } from \"../../../ComComponents/webconfig\";\r\nimport {\r\n  Dialog,\r\n  DialogFooter,\r\n  DialogType\r\n} from \"office-ui-fabric-react/lib/Dialog\";\r\nimport {\r\n  PrimaryButton,\r\n  DefaultButton\r\n} from \"office-ui-fabric-react/lib/Button\";\r\nimport { autobind } from \"office-ui-fabric-react/lib/Utilities\";\r\n\r\nexport class Attachments extends React.Component<\r\n  IAttachmentprop,\r\n  IAttachmentState\r\n> {\r\n  constructor(props: IAttachmentprop) {\r\n    super(props);\r\n    this.state = {\r\n      attitems: props.defaultatts || [],\r\n      hideDialog: true\r\n    };\r\n  }\r\n  public componentDidMount(): void {\r\n    this.initAttlist();\r\n  }\r\n  private initAttlist(): void {\r\n    let docid: number = this.props.docid;\r\n    let listName: string =\r\n      this.props.listName && this.props.listName.trim() !== \"\"\r\n        ? this.props.listName.trim()\r\n        : WebConfig.requestedItemsListName;\r\n    if (docid > 0 && this.state.attitems.length === 0) {\r\n      let atts: any[];\r\n      sp.web.lists\r\n        .getByTitle(listName)\r\n        .items.getById(docid)\r\n        .attachmentFiles.get()\r\n        .then(data => {\r\n          this.setState({\r\n            attitems: data\r\n          });\r\n        });\r\n    }\r\n  }\r\n  private DeleteAtt(name: string): void {\r\n    // console.log(name);\r\n    this.setState({\r\n      deletingFileName: name,\r\n      hideDialog: false\r\n    });\r\n  }\r\n  public render(): JSX.Element {\r\n    // console.log(this.state.attitems);\r\n    return (\r\n      <div>\r\n        <ul>\r\n          {this.state.attitems &&\r\n            this.state.attitems.map((item, index) => {\r\n              return (\r\n                <li>\r\n                  <a href={item.ServerRelativeUrl} target=\"_blank\">\r\n                    {item.FileName}\r\n                  </a>\r\n                  {this.props.deleteenable ||\r\n                  (this.props.listName === WebConfig.requestedItemsListName &&\r\n                    this.getDeleteEnable(item)) ? (\r\n                    <a\r\n                      aria-label=\"Delete icon\"\r\n                      className=\"btn_delete\"\r\n                      onClick={data => {\r\n                        this.DeleteAtt(item.FileName);\r\n                      }}\r\n                    >\r\n                      <i\r\n                        className=\"ms-Icon ms-Icon--Delete x-hidden-focus\"\r\n                        title=\"删除附件\"\r\n                        aria-hidden=\"true\"\r\n                      />\r\n                    </a>\r\n                  ) : null}\r\n                </li>\r\n              );\r\n            })}\r\n        </ul>\r\n        <Dialog\r\n          hidden={this.state.hideDialog}\r\n          onDismiss={this._closeDialog}\r\n          dialogContentProps={{\r\n            type: DialogType.normal,\r\n            title: \"删除确认\",\r\n            subText: \"确认要删除此附件吗？\"\r\n          }}\r\n          modalProps={{\r\n            titleAriaId: \"myLabelId\",\r\n            subtitleAriaId: \"mySubTextId\",\r\n            isBlocking: false,\r\n            containerClassName: \"ms-dialogMainOverride\"\r\n          }}\r\n        >\r\n          <DialogFooter>\r\n            <PrimaryButton onClick={this._confirmDialog} text=\"是\" />\r\n            <DefaultButton onClick={this._closeDialog} text=\"否\" />\r\n          </DialogFooter>\r\n        </Dialog>\r\n      </div>\r\n    );\r\n  }\r\n  @autobind\r\n  private _confirmDialog(): void {\r\n    if (this.state.deletingFileName && this.state.deletingFileName.length > 0) {\r\n      let docid: number = this.props.docid;\r\n      // this.setState({deletingFileName:null});\r\n      let name: string = this.state.deletingFileName;\r\n      let listName: string =\r\n        this.props.listName && this.props.listName.trim() !== \"\"\r\n          ? this.props.listName.trim()\r\n          : WebConfig.requestedItemsListName;\r\n      sp.web.lists\r\n        .getByTitle(listName)\r\n        .items.getById(docid)\r\n        .attachmentFiles.deleteMultiple(name)\r\n        .then(() => {\r\n          // this.initAttlist();\r\n          let data: any[] = this.state.attitems.filter((item, i) => {\r\n            return item.FileName !== name;\r\n          });\r\n          this.setState(\r\n            {\r\n              hideDialog: true,\r\n              attitems: data,\r\n              deletingFileName: null\r\n            },\r\n            () => {\r\n              if (this.props.setAtts) {\r\n                this.props.setAtts(data);\r\n              }\r\n            }\r\n          );\r\n        })\r\n        .catch(err => {\r\n          console.log(err);\r\n          alert(\"删除失败。\");\r\n          // this.setState({ hideDialog: true });\r\n        });\r\n    } else {\r\n      this.setState({ hideDialog: true });\r\n    }\r\n  }\r\n  @autobind\r\n  private _closeDialog(): void {\r\n    this.setState({ deletingFileName: null, hideDialog: true });\r\n  }\r\n  @autobind\r\n  private getDeleteEnable(item: any): boolean {\r\n    // console.log(item);\r\n    let fileName: string = item.FileName;\r\n    let addrIndex: number = fileName.lastIndexOf(\".\");\r\n    if (addrIndex > 2) {\r\n      fileName = fileName.substr(addrIndex - 2, 2);\r\n      // console.log(fileName);\r\n      return fileName === \"_s\";\r\n    }\r\n    return false;\r\n  }\r\n  public componentWillReceiveProps(nextProps: IAttachmentprop): void {\r\n    this.setState({\r\n      attitems: nextProps.defaultatts\r\n    });\r\n  }\r\n}\r\n"],"sourceRoot":"..\\..\\..\\..\\..\\src"}