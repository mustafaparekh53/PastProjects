{"version":3,"sources":["../../src/webparts/contractForm/components/contractutil.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,MAAM,EAAiB,MAAM,8BAA8B,CAAC;AACrE,OAAO,EAAE,SAAS,EAAE,UAAU,EAAE,MAAM,+BAA+B,CAAC;AACtE,OAAO,EAAE,SAAS,EAAE,MAAM,qCAAqC,CAAC;AAChE;IAAA;IAgFA,CAAC;IA/EQ,gCAAS,GAAhB,UAAiB,UAAe,EAAE,OAAY;QAA9C,iBA0CC;QAzCC,IAAI,OAAO,GAAW,EAAE,CAAC;QACzB,IAAI,IAAI,GAAW,EAAE,CAAC;QACtB,IAAI,SAAS,GAAW,EAAE,CAAC;QAC3B,4BAA4B;QAC5B;;;;;;;;;;;;;;;;eAgBO;QACP,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,GAAG,CAAC,UAAA,GAAG;YAC7B,OAAO,GAAG,MAAM,CAAC,MAAM,CACrB,SAAS,CAAC,uBAAuB,CAAC,OAAO,EACzC,OAAO,CAAC,KAAK,CACd,CAAC;YACF,IAAI,GAAG,MAAM,CAAC,MAAM,CAClB,SAAS,CAAC,uBAAuB,CAAC,IAAI,EACtC,SAAS,CAAC,aAAa,EAAE,EACzB,KAAI,CAAC,oBAAoB,CAAC,UAAU,CAAC,GAAG,CAAC,EAAE,KAAK,CAAC,CAClD,CAAC;YACF,SAAS,CAAC,aAAa,CAAC,QAAQ,CAAC,GAAG,EAAE,EAAE,CAAC,EAAE,IAAI,EAAE,OAAO,CAAC,CAAC;YAC1D,SAAS,IAAI,KAAI,CAAC,oBAAoB,CAAC,UAAU,CAAC,GAAG,CAAC,EAAE,IAAI,CAAC,CAAC;QAChE,CAAC,CAAC,CAAC;QACH,OAAO,GAAG,SAAS,CAAC,iBAAiB,CAAC,OAAO,CAAC;QAC9C,IAAI,GAAG,MAAM,CAAC,MAAM,CAClB,SAAS,CAAC,iBAAiB,CAAC,IAAI,EAChC,IAAI,CAAC,iBAAiB,EAAE,EACxB,SAAS,CACV,CAAC;QACF,SAAS,CAAC,SAAS,CAAC,OAAO,CAAC,KAAK,EAAE,IAAI,EAAE,OAAO,CAAC,CAAC;IACpD,CAAC;IACO,wCAAiB,GAAzB;QACE,IAAI,GAAG,GAAW,UAAU,CAAC;QAC7B,GAAG;YACD,GAAG,CAAC,MAAM,CAAC,CAAC,EAAE,GAAG,CAAC,WAAW,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,GAAG,SAAS,CAAC,mBAAmB,CAAC;QAC1E,MAAM,CAAC,aAAW,GAAG,sBAAS,CAAC;IACjC,CAAC;IACO,2CAAoB,GAA5B,UAA6B,IAAW,EAAE,QAAiB;QACzD,IAAI,GAAG,GAAW,UAAU,CAAC;QAC7B,IAAM,IAAI,GAAW,QAAQ;cACzB,SAAS,CAAC,eAAe;cACzB,SAAS,CAAC,YAAY,CAAC;QAC3B,GAAG,GAAG,GAAG,CAAC,MAAM,CAAC,CAAC,EAAE,GAAG,CAAC,WAAW,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC;QACrD,EAAE,CAAC,CAAC,IAAI,IAAI,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;YAC5B,EAAE,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;gBACb,qBAAqB;gBACrB,MAAM,CAAC,aAAW,IAAI,CAAC,GAAG,CACxB,UAAC,IAAI,EAAE,KAAK;oBACV,MAAM,CAAC,aAAW,GAAG,iBAAY,IAAI,CAAC,EAAE,SAAI,IAAI,CAAC,SAAS,aACxD,KAAK,GAAG,CAAC,GAAG,CAAC,GAAG,MAAM,GAAG,EAAE,CAC3B,CAAC;gBACL,CAAC,CACF,iBAAY,IAAI,CAAC,CAAC,CAAC,CAAC,MAAM,eAAY,CAAC;YAC1C,CAAC;YAAC,IAAI,CAAC,CAAC;gBACN,MAAM,CAAC,oEAA0B,IAAI;qBAClC,GAAG,CACF,UAAC,IAAI;oBACH,MAAM,CAAC,SAAO,IAAI,CAAC,IAAI,iBAAY,GAAG,iBAAY,IAAI,CAAC,EAAE,SACvD,IAAI,CAAC,KAAK,cACD,CAAC;gBACd,CAAC,CACF;qBACA,IAAI,CAAC,EAAE,CAAC,UAAO,CAAC;YACrB,CAAC;QACH,CAAC;QACD,MAAM,CAAC,EAAE,CAAC;IACZ,CAAC;IACH,mBAAC;AAAD,CAhFA,AAgFC,IAAA;;AACD,eAAe,IAAI,YAAY,EAAE,CAAC","file":"webparts/contractForm/components/contractutil.js","sourcesContent":["import { String, StringBuilder } from \"typescript-string-operations\";\r\nimport { WebConfig, CurrentUrl } from \"../../ComComponents/webconfig\";\r\nimport { EmailUtil } from \"../../ComComponents/Email/EmailUtil\";\r\nexport class ContractUtil {\r\n  public sendEmail(emailbodys: any, curUser: any): void {\r\n    let subject: string = \"\";\r\n    let body: string = \"\";\r\n    let mybodystr: string = \"\";\r\n    //  console.log(emailbodys);\r\n    /**\r\n         * id\r\n:\r\n77\r\nperson\r\n:\r\nundefined\r\nrequestNo\r\n:\r\n\"BCD20180711001\"\r\ntitle\r\n:\r\n\"测试合同名称\"\r\ntype\r\n:\r\nundefined\r\n         */\r\n    Object.keys(emailbodys).map(key => {\r\n      subject = String.Format(\r\n        WebConfig.EmailToApprovalTemplate.subject,\r\n        curUser.Title\r\n      );\r\n      body = String.Format(\r\n        WebConfig.EmailToApprovalTemplate.body,\r\n        EmailUtil.getsystemlink(),\r\n        this._getcontractlistlink(emailbodys[key], false)\r\n      );\r\n      EmailUtil.SendEmailbyId(parseInt(key, 10), body, subject);\r\n      mybodystr += this._getcontractlistlink(emailbodys[key], true);\r\n    });\r\n    subject = WebConfig.EmailToMeTemplate.subject;\r\n    body = String.Format(\r\n      WebConfig.EmailToMeTemplate.body,\r\n      this._getmyctrlistlink(),\r\n      mybodystr\r\n    );\r\n    EmailUtil.SendEmail(curUser.Email, body, subject);\r\n  }\r\n  private _getmyctrlistlink(): string {\r\n    let url: string = CurrentUrl;\r\n    url =\r\n      url.substr(0, url.lastIndexOf(\"/\") + 1) + WebConfig.CreatedByMeListPage;\r\n    return `<a href=${url}>点击</a>`;\r\n  }\r\n  private _getcontractlistlink(cont: any[], sendtome: boolean): string {\r\n    let url: string = CurrentUrl;\r\n    const page: string = sendtome\r\n      ? WebConfig.NewContractPage\r\n      : WebConfig.ApprovalPage;\r\n    url = url.substr(0, url.lastIndexOf(\"/\") + 1) + page;\r\n    if (cont && cont.length > 0) {\r\n      if (sendtome) {\r\n        // console.log(cont);\r\n        return `<tr><td>${cont.map(\r\n          (item, index): string => {\r\n            return `<a href=${url}?request=${item.id}>${item.requestNo}</a>${\r\n              index % 2 > 0 ? \"<br>\" : \"\"\r\n            }`;\r\n          }\r\n        )}</td><td>${cont[0].person}</td></tr>`;\r\n      } else {\r\n        return `<div>待审批合同清单：</div><ol>${cont\r\n          .map(\r\n            (item): string => {\r\n              return `<li>${item.type}:<a href=${url}?request=${item.id}>${\r\n                item.title\r\n              }</a></li>`;\r\n            }\r\n          )\r\n          .join(\"\")}</ol>`;\r\n      }\r\n    }\r\n    return \"\";\r\n  }\r\n}\r\nexport default new ContractUtil();\r\n"],"sourceRoot":"..\\..\\..\\..\\src"}